### Xamarin Recognizer
Простое и самодостаточное приложение-пример для распознавания речи на платформе Xamarin. Пример доступен только для платформы Android.  
Основной синтаксис и логика находятся в файле `Xamarin.Recognize/MainPage.xaml.cs`  
приложение состоит из 3 логических частей:
1. Аудио часть. Обеспечивается плагином Plugin.AudioRecorder из [библиотеки NUGET](https://www.nuget.org/packages/Plugin.AudioRecorder"). В приложении доступен отдельный пункт меню "Recording Test", внитри которого можно запустить/остановить запись ("Start Record"/ StopRecord"), а также прослушать запись ("Play Sample").
2. Подготовка модели. Реализован в методе CheckModelFolder и вызываемых подметодах:
	 - Проверяет наличие модели в папке. Если есть, то скармливает папку Vosk'у.
	 - Если нет, проверяет, скачан ли архив. Если скачан, то разархивирует, а результат перемещает в целевую папку модели. Архив удаляется
	 - Если нет, то качает.

3.Модуль распознавания. Обеспечивается [библиотекой Vosk](https://alphacephei.com/vosk/). В приложении есть 2 блока работы с приложением:
 - RecognizeRecordedSample. Распознаёт ранее записанный аудиофайл.
 - RecognizeRealtime. Одновременно запускает аудиозапись, а актуальные аудиоданные закидывает в Vosk.

### Подключение Vosk
Для начала нужно подключить библиотеку. В текущем проекте уже всё подключено для armv7. Как это сделать самостоятельно?  
1. Перейдите на [страницу Github](https://github.com/alphacep/vosk-api/releases).
2. В актуальной/понравившейся версии выберите `vosk-linux-armv7l-*****.zip` для андроид-устройств и  `vosk-linux-x86_64-******.zip` для эмуляторов. 
3. Содержащиеся в архивах файлы `libvosk.so` поместите в `[Папка Android-проекта]/libs/`
	- `armeabi-v7a/` из архива `vosk-linux-armv7l...`
	- `x86_64/` из архива `vosk-linux-x86_64...`

4. Далее нужно подключить .dll к основному Xamarin проекту. Можете взять ` XamarinVoskSample/Vosk.dll`, это результат билда версии 0.3.32 => SourceCode.zip, в архиве `vosk-api-0.3.32/csharp/nuget/src`. Можете даже их в папку отдельно закинуть, сути мало поменяет. Если всё же библиотека, то далее в самом проекте Dependencies => Add Project Reference => Browse... и выбираете .dll  
5. Выбираете нужную [модель из списка](https://alphacephei.com/vosk/models). Ссылку на модель добавляете в своё приложение.
6. Я не разобрался, как поставлять приложение с предустановленной моделью. Поэтому придётся качать Runtime. Методы-образцы можете взять `Xamarin.Recognize/MainPage.xaml.cs => CheckModelFolder() и вызываемые`.

В подключении к Iphone я ничего не могу от себя сказать. [Статья на Хабре](https://habr.com/ru/post/435210/)  поможет без крови из глаз от [машинного переводчика фирменного сухого текста Майкрософта] разобраться с подключением библиотеки.

### Проблемы и решения
* Android Разрешения. Для использования микрофона необходимы разрешения Record_audio и Capture_audio_output в манифесте, а также запрашивать разрешение на использование в самом приложении. Xamarin.Essentials решает эту задачу в методе `RequestAllPermissions()` файла `Xamarin.Recognize/MainPage.xaml.cs`
* Старт модуля заставляет приложение виснуть. Разработчики Vosk в примерах/самой библиотеке не предоставляют возможность грузить модель в ОЗУ асинхронно. В моём приложении модуль инициализируется в отдельном потоке. Работает такой подход достаточно шустро.